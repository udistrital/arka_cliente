<div class="col-lg-12">
  <nb-card>
    <nb-card-header>Registrar Acta Recibido</nb-card-header>
    <nb-card-body>
      <mat-vertical-stepper [linear]="true" #stepper>
        <mat-step [stepControl]="firstForm" label="Datos Iniciales">
          <form [formGroup]="firstForm" (ngSubmit)="onFirstSubmit()" #fform="ngForm" class="step-container">
            <nb-card>
              <nb-card-header>Datos Iniciales de Recibido</nb-card-header>
              <nb-card-body>
                <div class="row">
                  <div class="form-group col-sm">
                    <label>Sede</label>
                    <select class="form-control" formControlName="Sede" required>
                      <option>Sede 1</option>
                      <option>Sede 2</option>
                      <option>Sede 3</option>
                      <option>Sede 4</option>
                      <option>Sede 5</option>
                    </select>
                  </div>
                  <div class="form-group col-sm">
                    <label>Dependencia</label>
                    <select class="form-control" formControlName="Dependencia" required>
                      <option>Dependencia 1</option>
                      <option>Dependencia 2</option>
                      <option>Dependencia 3</option>
                      <option>Dependencia 4</option>
                      <option>Dependencia 5</option>
                    </select>
                  </div>
                  <div class="form-group col-sm">
                    <label>Ubicación</label>
                    <select class="form-control" formControlName="Ubicacion" required>
                      <option>Ubicación 1</option>
                      <option>Ubicación 2</option>
                      <option>Ubicación 3</option>
                      <option>Ubicación 4</option>
                      <option>Ubicación 5</option>
                    </select>
                  </div>
                </div>
              </nb-card-body>
            </nb-card>
            <button nbButton matStepperNext [disabled]="!firstForm.valid" class="float-right">Siguiente</button>
          </form>
        </mat-step>
        <mat-step [stepControl]="secondForm" label="Datos de Soporte">
          <form [formGroup]="secondForm" (ngSubmit)="onSecondSubmit()" #fform2="ngForm" class="step-container">
            <nb-card>
              <nb-card-header></nb-card-header>
              <nb-card-body>
                <mat-tab-group [selectedIndex]="selected.value" (selectedIndexChange)="selected.setValue($event)">
                  <mat-tab *ngFor="let tab of tabs; let i = index" [formGroupName]="i">
                    <ng-template mat-tab-label>
                      {{tab}} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<i class="fas fa-window-close"
                        (click)="removeTab(i)"></i>
                    </ng-template>
                    <nb-card>
                      <nb-card-header>Datos de Soporte</nb-card-header>
                      <nb-card-body>
                        <div class="row">
                          <div class="form-group col-sm">
                            <label>Proveedor</label>
                            <div class="input-group">
                              <input type="text" placeholder="NIT o Razón social" class="form-control"
                                formControlName="Proveedor" required>
                            </div>
                          </div>
                          <div class="form-group col-sm">
                            <label>Consecutivo de Factura o de Soporte</label>
                            <div class="input-group">
                              <input nbInput type="text" placeholder="Consecutivo" class="form-control"
                                formControlName="Consecutivo" required>
                            </div>
                          </div>
                        </div>
                        <div class="row">
                          <div class="form-group col-sm">
                            <label>Fecha de Factura o de Soporte</label>
                            <div class="input-group">
                              <input nbInput placeholder="Selecciona la Fecha" class="form-control"
                                [nbDatepicker]="formpicker" formControlName="Fecha_Factura" required>
                              <nb-datepicker #formpicker></nb-datepicker>
                            </div>
                          </div>
                          <div class="form-group col-sm">
                            <label>Factura o Soporte a Relacionar</label>
                            <input nbInput type="file" class="form-control-file" id="factura" formControlName="Soporte"
                              required>
                          </div>
                        </div>
                      </nb-card-body>
                    </nb-card>
                    <nb-card>
                      <nb-card-header>Articulos Relacionados</nb-card-header>
                      <nb-card-body>
                        <div class="example-container mat-elevation-z8">
                          <table mat-table [dataSource]="dataSource">

                            <!-- Tipo de Bien -->
                            <ng-container matColumnDef="TipoBienId">
                              <th mat-header-cell *matHeaderCellDef> Tipo de Bien </th>
                              <td mat-cell *matCellDef="let element"> {{element.TipoBienId.Nombre}} </td>
                            </ng-container>

                            <!-- Subgrupo Catalogo -->
                            <ng-container matColumnDef="SubgrupoCatalogoId">
                              <th mat-header-cell *matHeaderCellDef> Subgrupo</th>
                              <td mat-cell *matCellDef="let element"> {{element.SubgrupoCatalogoId}} </td>
                            </ng-container>

                            <!-- Nombre Catalogo -->
                            <ng-container matColumnDef="Nombre">
                              <th mat-header-cell *matHeaderCellDef> Nombre</th>
                              <td mat-cell *matCellDef="let element"> {{element.Nombre}} </td>
                            </ng-container>

                            <!-- RevisorId Column -->
                            <ng-container matColumnDef="RevisorId">
                              <th mat-header-cell *matHeaderCellDef> Revisor </th>
                              <td mat-cell *matCellDef="let element"> {{element.SoporteActaId.ActaRecibidoId.RevisorId}}
                              </td>
                            </ng-container>

                            <!-- Cantidad Column -->
                            <ng-container matColumnDef="Cantidad">
                              <th mat-header-cell *matHeaderCellDef> Cantidad </th>
                              <td mat-cell *matCellDef="let element"> {{element.Cantidad}} </td>
                            </ng-container>

                            <!-- Marca Column -->
                            <ng-container matColumnDef="Marca">
                              <th mat-header-cell *matHeaderCellDef> Marca </th>
                              <td mat-cell *matCellDef="let element"> {{element.Marca}} </td>
                            </ng-container>

                            <!-- Serie Column -->
                            <ng-container matColumnDef="Serie">
                              <th mat-header-cell *matHeaderCellDef> Serie </th>
                              <td mat-cell *matCellDef="let element"> {{element.Serie}} </td>
                            </ng-container>

                            <!-- UnidadMedida Column -->
                            <ng-container matColumnDef="UnidadMedida">
                              <th mat-header-cell *matHeaderCellDef> Unidad de Medida </th>
                              <td mat-cell *matCellDef="let element"> {{element.UnidadMedida}} </td>
                            </ng-container>

                            <!-- ValorUnitario Column -->
                            <ng-container matColumnDef="ValorUnitario">
                              <th mat-header-cell *matHeaderCellDef> Valor Unitario </th>
                              <td mat-cell *matCellDef="let element"> {{element.ValorUnitario}} </td>
                            </ng-container>

                            <!-- Subtotal Column -->
                            <ng-container matColumnDef="Subtotal">
                              <th mat-header-cell *matHeaderCellDef> Subtotal </th>
                              <td mat-cell *matCellDef="let element"> {{element.Subtotal | currency}} </td>
                            </ng-container>

                            <!-- Descuento Column -->
                            <ng-container matColumnDef="Descuento">
                              <th mat-header-cell *matHeaderCellDef> Descuento </th>
                              <td mat-cell *matCellDef="let element"> {{element.Descuento}} </td>
                            </ng-container>

                            <!-- PorcentajeIvaId Column -->
                            <ng-container matColumnDef="PorcentajeIvaId">
                              <th mat-header-cell *matHeaderCellDef> PorcentajeIvaId </th>
                              <td mat-cell *matCellDef="let element"> 
                                  <input nbInput type="text" [value]="element.PorcentajeIvaId" placeholder="Valor Total" required> 
                              </td>
                            </ng-container>

                            <!-- ValorIva Column -->
                            <ng-container matColumnDef="ValorIva">
                              <th mat-header-cell *matHeaderCellDef> ValorIva </th>
                              <td mat-cell *matCellDef="let element"> 
                                <input nbInput type="text" [value]="element.ValorIva | currency" placeholder="Valor Total" required>
                              </td>
                            </ng-container>

                            <!-- ValorTotal Column -->
                            <ng-container matColumnDef="ValorTotal">
                              <th mat-header-cell *matHeaderCellDef> ValorTotal </th>
                              <td mat-cell *matCellDef="let element">
                                <input nbInput style="width: 70%" type="text" [value]="element.ValorTotal | currency" placeholder="Valor Total" required>
                              </td>
                            </ng-container>

                            <!-- Acciones Column -->
                            <ng-container matColumnDef="Acciones">
                              <th mat-header-cell *matHeaderCellDef>
                                <i class="fas fa-plus-square"></i>
                              </th>
                              <td mat-cell *matCellDef="let element">
                                <i class="far fa-check-square"></i> &nbsp;
                                <i class="far fa-edit"></i>&nbsp;
                                <i class="far fa-window-close"></i>
                              </td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                          </table>
                        </div>
                      </nb-card-body>
                    </nb-card>
                  </mat-tab>
                  <mat-tab [disabled]="true">
                    <ng-template mat-tab-label>
                      <i class="fas fa-plus-square fa-2x" (click)="addTab()"></i>
                    </ng-template>
                  </mat-tab>
                </mat-tab-group>
              </nb-card-body>
            </nb-card>
            <div class="justify-content-center">
              <button nbButton matStepperPrevious>Anterior</button>
              <button nbButton matStepperNext [disabled]="!secondForm.valid" class="float-right">Siguiente</button>
            </div>
          </form>
        </mat-step>
        <mat-step [stepControl]="thirdForm" label="Datos Adicionales">
          <form [formGroup]="thirdForm" (ngSubmit)="onThirdSubmit()" #fform3="ngForm" class="step-container">
            <nb-card>
              <nb-card-header>Gran Consolidado</nb-card-header>
              <nb-card-body>
                <table class="table text-center">
                  <tr>
                    <td class="thead-dark">Gran Subtotal</td>
                    <td>14'000.000</td>
                  </tr>
                  <tr>
                    <td class="thead-dark">Gran Descuentos</td>
                    <td>0</td>
                  </tr>
                  <tr>
                    <td class="thead-dark">Gran IVA</td>
                    <td>1'900.000</td>
                  </tr>
                  <tr>
                    <td class="thead-dark">Gran Total</td>
                    <td>15'900.000</td>
                  </tr>
                </table>
              </nb-card-body>
            </nb-card>
            <nb-card>
              <nb-card-header>Datos Adicionales</nb-card-header>
              <nb-card-body>
                <div class="form-group  col-lg-12">
                  <label>Observaciones</label>
                  <div class="input-group">
                    <textarea rows="5"
                      placeholder="Proporciona datos adicionales que no se pueden expresar en el formulario"
                      class="form-control" formControlName="Datos_Adicionales" required></textarea>
                  </div>
                </div>
              </nb-card-body>
            </nb-card>
            <div class="justify-content-center">
              <button nbButton matStepperPrevious>Anterior</button>
              <button nbButton matStepperNext [disabled]="!thirdForm.valid" class="float-right">Siguiente</button>
            </div>
          </form>
        </mat-step>
        <mat-step [hidden]="true" label="Registro Completado">
          <div class="step-container">
            <h3>Registro Completado!</h3>
            <button nbButton (click)="stepper.reset()">Try again</button>
          </div>
        </mat-step>
      </mat-vertical-stepper>
    </nb-card-body>
  </nb-card>
</div>