<div *ngIf="!firstForm" [nbSpinner]="!firstForm">
  <nb-card>
    <nb-card-header>

    </nb-card-header>
    <nb-card-body>

    </nb-card-body>
  </nb-card>
</div>
<div class="col-lg-12" *ngIf="firstForm">
  <form [formGroup]="firstForm" #fform="ngForm" class="step-container">
    <nb-card>
      <nb-card-header>{{'GLOBAL.Acta_Recibido.RegistroActa.Title' | translate}}</nb-card-header>
      <nb-card-body>
        <mat-vertical-stepper [linear]="true" #stepper>
          <mat-step label="{{'GLOBAL.Acta_Recibido.RegistroActa.DatosTitle' | translate}}" formGroupName="Formulario1">
            <nb-card [nbSpinner]="!Sedes">
              <nb-card-body>
                <div class="row">
                  <div class="form-group col-sm">
                    <label>{{'GLOBAL.Acta_Recibido.RegistroActa.Sede' | translate}}</label>
                    <select nbInput type="text" class="form-control" formControlName="Sede" required>
                      <option *ngFor="let sede of Sedes" [(value)]="sede.Id">{{sede.Nombre}}</option>
                    </select>
                  </div>
                  <div class="form-group col-sm">
                    <label>{{'GLOBAL.Acta_Recibido.RegistroActa.Dependencia' | translate}}</label>
                    <ng2-completer inputClass="form-control" nbInput [datasource]="dataService3"
                      formControlName="Dependencia" [minSearchLength]="3">
                    </ng2-completer>
                  </div>
                  <div class="form-group col-sm">
                    <label>{{'GLOBAL.Acta_Recibido.RegistroActa.Ubicacion' | translate}}</label>
                    <ng2-completer inputClass="form-control" nbInput [datasource]="dataService"
                      formControlName="Ubicacion" [minSearchLength]="3">
                    </ng2-completer>
                  </div>
                </div>
              </nb-card-body>
              <nb-card-footer>
                <button nbButton matStepperNext [disabled]="!firstForm.get('Formulario1').valid"
                  class="float-right">{{'GLOBAL.Acta_Recibido.RegistroActa.SiguienteButton' | translate}}</button>
              </nb-card-footer>
            </nb-card>

          </mat-step>
          <mat-step label="{{'GLOBAL.Acta_Recibido.RegistroActa.SoporteTitle' | translate}}"
            formArrayName="Formulario2">
            <nb-card>
              <nb-card-body>
                <mat-tab-group [selectedIndex]="selected.value" (selectedIndexChange)="selected.setValue($event)">
                  <mat-tab *ngFor="let soporte of firstForm.get('Formulario2').controls; let i = index"
                    [formGroupName]="i">
                    <ng-template mat-tab-label>
                      {{'GLOBAL.Acta_Recibido.RegistroActa.SoporteSubTitle' | translate}} &nbsp; {{i + 1}} &nbsp; &nbsp;
                      &nbsp; &nbsp;<i class="fas fa-window-close" (click)="removeTab(i)"></i>
                    </ng-template>
                    <div>
                      <nb-card>
                        <nb-card-body>
                          <div class="row">
                            <div class="form-group col-sm">
                              <label>{{'GLOBAL.Acta_Recibido.RegistroActa.Proveedor' | translate}}</label>
                              <ng2-completer inputClass="form-control"
                                placeholder="{{'GLOBAL.Acta_Recibido.RegistroActa.SeleccioneFiltro' | translate}}"
                                nbInput [datasource]="dataService2" formControlName="Proveedor" [minSearchLength]="3">
                              </ng2-completer>
                            </div>
                            <div class="form-group col-sm">
                              <label>{{'GLOBAL.Acta_Recibido.RegistroActa.Consecutivo' | translate}}</label>
                              <div class="input-group">
                                <input nbInput type="text"
                                  placeholder="{{'GLOBAL.Acta_Recibido.RegistroActa.SeleccioneFiltro' | translate}}"
                                  class="form-control" formControlName="Consecutivo" required>
                              </div>
                            </div>
                          </div>
                          <div class="row">
                            <div class="form-group col-sm">
                              <label>{{'GLOBAL.Acta_Recibido.RegistroActa.FechaSoporte' | translate}}</label>
                              <div class="input-group">
                                <input nbInput
                                  placeholder="{{'GLOBAL.Acta_Recibido.RegistroActa.FechaFiltro' | translate}}"
                                  class="form-control" [nbDatepicker]="formpicker" formControlName="Fecha_Factura"
                                  required>
                                <nb-datepicker #formpicker></nb-datepicker>
                              </div>
                            </div>
                            <div class="form-group col-sm">
                              <label>{{'GLOBAL.Acta_Recibido.RegistroActa.Soporte' | translate}}</label>
                              <input nbInput type="file" class="form-control-file" id="factura"
                                formControlName="Soporte" required>
                            </div>
                          </div>
                        </nb-card-body>
                      </nb-card>

                      <ngx-capturar-elementos (DatosTotales)="ver2($event,i)" (DatosEnviados)="ver($event, i)">
                      </ngx-capturar-elementos>

                    </div>
                  </mat-tab>
                  <mat-tab [disabled]="true">
                    <ng-template mat-tab-label>
                      <i class="fas fa-plus-square fa-2x" (click)="addTab()"></i>
                    </ng-template>
                  </mat-tab>
                </mat-tab-group>
              </nb-card-body>
              <nb-card-footer>
                <div class="justify-content-center">
                  <button nbButton
                    matStepperPrevious>{{'GLOBAL.Acta_Recibido.RegistroActa.AnteriorButton' | translate}}</button>
                  <button nbButton matStepperNext (click)="Revisar_Totales()"
                    [disabled]="!firstForm.get('Formulario1').valid || !firstForm.get('Formulario2').valid"
                    class="float-right">{{'GLOBAL.Acta_Recibido.RegistroActa.SiguienteButton' | translate}}</button>
                </div>
              </nb-card-footer>
            </nb-card>

          </mat-step>
          <mat-step label="Datos Adicionales" formGroupName="Formulario3">
            <nb-card *ngIf="Totales">
              <nb-card-header>{{'GLOBAL.Acta_Recibido.RegistroActa.Consolidado' | translate}}</nb-card-header>
              <nb-card-body>
                <table class="table text-center">
                  <tr>
                    <td class="thead-dark">{{'GLOBAL.Acta_Recibido.RegistroActa.Subtotal' | translate}}</td>
                    <td>{{getGranSubtotal() | currency}}</td>
                  </tr>
                  <tr>
                    <td class="thead-dark">{{'GLOBAL.Acta_Recibido.RegistroActa.Descuento' | translate}}</td>
                    <td>{{getGranDescuentos() | currency}}</td>
                  </tr>
                  <tr>
                    <td class="thead-dark">{{'GLOBAL.Acta_Recibido.RegistroActa.IVA' | translate}}</td>
                    <td>{{getGranValorIva() | currency}}</td>
                  </tr>
                  <tr>
                    <td class="thead-dark">{{'GLOBAL.Acta_Recibido.RegistroActa.Total' | translate}}</td>
                    <td>{{getGranTotal() | currency}}</td>
                  </tr>
                </table>
              </nb-card-body>
            </nb-card>
            <nb-card>
              <nb-card-header>{{'GLOBAL.Acta_Recibido.RegistroActa.DatosAdicionales' | translate}}</nb-card-header>
              <nb-card-body>
                <div class="form-group  col-lg-12">
                  <label>{{'GLOBAL.Acta_Recibido.RegistroActa.Observaciones' | translate}}</label>
                  <div class="input-group">
                    <textarea rows="5" placeholder="{{'GLOBAL.Acta_Recibido.RegistroActa.Observaciones2' | translate}}"
                      class="form-control" formControlName="Datos_Adicionales" required></textarea>
                  </div>
                </div>
              </nb-card-body>
              <nb-card-footer>
                <div class="justify-content-center">
                  <button nbButton
                    matStepperPrevious>{{'GLOBAL.Acta_Recibido.RegistroActa.AnteriorButton' | translate}}</button>
                  <button nbButton matStepperNext (click)="Revisar_Totales2()"
                    [disabled]="!firstForm.get('Formulario3').valid || !firstForm.get('Formulario2').valid || !firstForm.get('Formulario3').valid"
                    class="float-right">{{'GLOBAL.Acta_Recibido.RegistroActa.GuardarCambiosButton' | translate}}</button>
                </div>
              </nb-card-footer>
            </nb-card>

          </mat-step>
        </mat-vertical-stepper>
      </nb-card-body>
    </nb-card>
  </form>
</div>
<!-- <div *ngIf="firstForm">
  <code>
    <pre>
      {{firstForm.value | json}}
    </pre>
  </code>
</div> -->