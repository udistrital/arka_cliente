<div class="col-lg-12">
  <form [formGroup]="firstForm" #fform="ngForm" class="step-container" *ngIf="firstForm">
    <nb-card>
      <nb-card-header>Verificacion del Acta Recibido</nb-card-header>
      <nb-card-body >
            <nb-card formGroupName="Formulario1">
              <nb-card-header>Datos Iniciales de Recibido</nb-card-header>
              <nb-card-body>
                <div class="row">
                  <div class="form-group col-sm">
                    <label>Sede</label>
                    <input class="form-control" formControlName="Sede" readonly>
                  </div>
                  <div class="form-group col-sm">
                    <label>Dependencia</label>
                    <input class="form-control" formControlName="Dependencia" readonly>
                  </div>
                  <div class="form-group col-sm">
                    <label>Ubicación</label>
                    <input class="form-control" formControlName="Ubicacion" readonly>
                  </div>
                </div>
              </nb-card-body>
            </nb-card>
            <nb-card formArrayName="Formulario2">
              <nb-card-header>Datos de Soporte</nb-card-header>
              <nb-card-body>
                <mat-tab-group [selectedIndex]="selected.value" (selectedIndexChange)="selected.setValue($event)">
                  <mat-tab *ngFor="let soporte of firstForm.get('Formulario2').controls; let i = index"
                    [formGroupName]="i">
                    <ng-template mat-tab-label>
                      Soporte &nbsp; {{i + 1}} 
                    </ng-template>
                    <div>
                      <nb-card>
                        <nb-card-header>Datos de Soporte</nb-card-header>
                        <nb-card-body>
                          <div class="row">
                            <div class="form-group col-sm">
                              <label>Proveedor</label>
                              <div class="input-group">
                                <input type="text" placeholder="NIT o Razón social" class="form-control"
                                  formControlName="Proveedor" readonly>
                              </div>
                            </div>
                            <div class="form-group col-sm">
                              <label>Consecutivo de Factura o de Soporte</label>
                              <div class="input-group">
                                <input nbInput type="text" placeholder="Consecutivo" class="form-control"
                                  formControlName="Consecutivo" readonly>
                              </div>
                            </div>
                          </div>
                          <div class="row">
                            <div class="form-group col-sm">
                              <label>Fecha de Factura o de Soporte</label>
                              <div class="input-group">
                                <input nbInput placeholder="Selecciona la Fecha" class="form-control"
                                  [nbDatepicker]="formpicker" formControlName="Fecha_Factura" readonly>
                                <nb-datepicker #formpicker></nb-datepicker>
                              </div>
                            </div>
                            <div class="form-group col-sm">
                              <label>Factura o Soporte a Relacionar</label>
                              <input nbInput type="file" class="form-control-file" id="factura"
                                formControlName="Soporte" required>
                            </div>
                          </div>
                        </nb-card-body>
                      </nb-card>
                      <nb-card>
                        <nb-card-header>Articulos Relacionados</nb-card-header>
                        <nb-card-body>
                          <div class="example-container mat-elevation-z8">
                            <table mat-table #MatTable formArrayName="Elementos" [dataSource]='soporte.get("Elementos").controls'>

                              <!-- Tipo de Bien -->
                              <ng-container matColumnDef="TipoBienId">
                                <th mat-header-cell *matHeaderCellDef> Tipo de Bien </th>
                                <td mat-cell  *matCellDef="let element; let rowIndex = index" 
                                  [formGroupName]="rowIndex">
                                  <select type="text" class="cell-2 form-control" 
                                  formControlName="TipoBienId" placeholder="Tipo de Bien" readonly>
                                    <option *ngFor="let tipobien of Tipos_Bien" [(value)]="tipobien.Id">{{tipobien.Nombre}}</option>
                                  </select>
                              </ng-container>
                              <!-- Subgrupo Catalogo -->
                              <ng-container matColumnDef="SubgrupoCatalogoId">
                                <th mat-header-cell *matHeaderCellDef> Subgrupo</th>
                                <td mat-cell  *matCellDef="let element; let rowIndex = index" 
                                  [formGroupName]="rowIndex">
                                  <input nbInput type="text" fieldSize="tiny" class="cell" 
                                    formControlName="SubgrupoCatalogoId" placeholder="Subcatalogo" readonly>
                                </td>
                              </ng-container>

                              <!-- Nombre Catalogo -->
                              <ng-container matColumnDef="Nombre">
                                <th mat-header-cell *matHeaderCellDef> Descripcion </th>
                                <td mat-cell  *matCellDef="let element; let rowIndex = index" 
                                  [formGroupName]="rowIndex">
                                  <input nbInput type="text" fieldSize="tiny" class="cell" formControlName="Nombre" 
                                    placeholder="Descripcion" readonly>

                                </td>
                              </ng-container>

                              <!-- Cantidad Column -->
                              <ng-container matColumnDef="Cantidad">
                                <th mat-header-cell *matHeaderCellDef> Cantidad </th>
                                <td mat-cell  *matCellDef="let element; let rowIndex = index" 
                                  [formGroupName]="rowIndex">
                                  <input nbInput type="number" fieldSize="tiny" class="cell"  formControlName="Cantidad" 
                                  placeholder="Cantidad" readonly>
                                </td>
                              </ng-container>

                              <!-- Marca Column -->
                              <ng-container matColumnDef="Marca">
                                <th mat-header-cell *matHeaderCellDef> Marca </th>
                                <td mat-cell  *matCellDef="let element; let rowIndex = index" 
                                  [formGroupName]="rowIndex">
                                  <input nbInput type="text" fieldSize="tiny" class="cell"  formControlName="Marca"
                                    placeholder="Marca" readonly>
                                </td>
                              </ng-container>

                              <!-- Serie Column -->
                              <ng-container matColumnDef="Serie">
                                <th mat-header-cell *matHeaderCellDef> Serie </th>
                                <td mat-cell  *matCellDef="let element; let rowIndex = index" 
                                  [formGroupName]="rowIndex">
                                  <input nbInput type="text" fieldSize="tiny" class="cell"  formControlName="Serie"
                                    placeholder="Serie" readonly>
                                </td>
                              </ng-container>

                              <!-- UnidadMedida Column -->
                              <ng-container matColumnDef="UnidadMedida">
                                <th mat-header-cell *matHeaderCellDef> Unidad de Medida </th>
                                <td mat-cell  *matCellDef="let element; let rowIndex = index" 
                                  [formGroupName]="rowIndex">
                                  <input nbInput type="number" fieldSize="tiny" class="cell" 
                                    formControlName="UnidadMedida" placeholder="Medida" readonly>
                                </td>
                              </ng-container>

                              <!-- ValorUnitario Column -->
                              <ng-container matColumnDef="ValorUnitario">
                                <th mat-header-cell *matHeaderCellDef> Valor Unitario </th>
                                <td mat-cell  *matCellDef="let element; let rowIndex = index" 
                                  [formGroupName]="rowIndex">
                                  <input nbInput type="text" fieldSize="tiny" class="cell" 
                                    formControlName="ValorUnitario" placeholder="Valor Unitario" readonly>
                                </td>
                              </ng-container>

                              <!-- Subtotal Column -->
                              <ng-container matColumnDef="Subtotal">
                                <th mat-header-cell *matHeaderCellDef> Subtotal </th>
                                <td mat-cell  *matCellDef="let element; let rowIndex = index" 
                                  [formGroupName]="rowIndex">
                                  <input nbInput type="text" fieldSize="tiny" class="cell"  formControlName="Subtotal"
                                    placeholder="Subtotal" readonly>
                                </td>
                              </ng-container>

                              <!-- Descuento Column -->
                              <ng-container matColumnDef="Descuento">
                                <th mat-header-cell *matHeaderCellDef> Descuento </th>
                                <td mat-cell  *matCellDef="let element; let rowIndex = index" 
                                  [formGroupName]="rowIndex">
                                  <input nbInput type="text" fieldSize="tiny" class="cell"  formControlName="Descuento" 
                                    placeholder="Descuento" readonly>
                                </td>
                              </ng-container>

                              <!-- PorcentajeIvaId Column -->
                              <ng-container matColumnDef="PorcentajeIvaId">
                                <th mat-header-cell *matHeaderCellDef> % IVA </th>
                                <td mat-cell  *matCellDef="let element; let rowIndex = index" 
                                  [formGroupName]="rowIndex">
                                  <input nbInput type="number" fieldSize="tiny" class="cell" 
                                    formControlName="PorcentajeIvaId" placeholder="% IVA" readonly>
                                </td>
                              </ng-container>

                              <!-- ValorIva Column -->
                              <ng-container matColumnDef="ValorIva">
                                <th mat-header-cell *matHeaderCellDef> ValorIva </th>
                                <td mat-cell  *matCellDef="let element; let rowIndex = index" 
                                  [formGroupName]="rowIndex">
                                  <input nbInput type="text" fieldSize="tiny" class="cell"
                                    formControlName="ValorIva" placeholder="Valor Iva" readonly>
                                </td>
                              </ng-container>

                              <!-- ValorTotal Column -->
                              <ng-container matColumnDef="ValorTotal">
                                <th mat-header-cell *matHeaderCellDef> ValorTotal </th>
                                <td mat-cell  *matCellDef="let element; let rowIndex = index" 
                                  [formGroupName]="rowIndex">
                                  <input nbInput type="text" fieldSize="tiny" class="cell" 
                                    formControlName="ValorTotal" placeholder="Valor Total" readonly>
                                </td>
                              </ng-container>

                              <!-- Acciones Column -->
                              <ng-container matColumnDef="Acciones">
                                <th mat-header-cell *matHeaderCellDef> Verificar </th>
                                <td mat-cell *matCellDef="let element; let rowIndex = index" 
                                  [formGroupName]="rowIndex">
                                  <nb-checkbox formControlName="Verificado"></nb-checkbox>
                                </td>
                              </ng-container>

                              <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                            </table>
                          </div>
                        </nb-card-body>
                      </nb-card>
                    </div>
                  </mat-tab>
                  
                </mat-tab-group>
              </nb-card-body>
            </nb-card>
            <nb-card>
              <nb-card-header>Gran Consolidado</nb-card-header>
              <nb-card-body>
                <table class="table text-center">
                  <tr>
                    <td class="thead-dark">Gran Subtotal</td>
                    <td>14'000.000</td>
                  </tr>
                  <tr>
                    <td class="thead-dark">Gran Descuentos</td>
                    <td>0</td>
                  </tr>
                  <tr>
                    <td class="thead-dark">Gran IVA</td>
                    <td>1'900.000</td>
                  </tr>
                  <tr>
                    <td class="thead-dark">Gran Total</td>
                    <td>15'900.000</td>
                  </tr>
                </table>
              </nb-card-body>
            </nb-card>
            <nb-card formGroupName="Formulario3">
              <nb-card-header>Datos Adicionales</nb-card-header>
              <nb-card-body>
                <div class="form-group  col-lg-12">
                  <label>Observaciones</label>
                  <div class="input-group">
                    <textarea rows="5"
                      placeholder="Proporciona datos adicionales que no se pueden expresar en el formulario"
                      class="form-control" formControlName="Datos_Adicionales" required></textarea>
                  </div>
                </div>
                <div class="justify-content-center">
                    <button nbButton (click)="Revisar_Totales2()">Rechazar</button>
                    <button nbButton (click)="Revisar_Totales()" class="float-right" >Aceptar</button>
                  </div>
              </nb-card-body>
            </nb-card>
      </nb-card-body>
    </nb-card>
  </form>
</div>